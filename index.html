<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026학년도 고입 진학 관리 시스템</title>
  
  <!-- Tailwind CSS (디자인) -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- FontAwesome (아이콘) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    body { font-family: 'Pretendard', sans-serif; background-color: #f8fafc; margin: 0; padding: 0; }
    
    /* 스크롤바 디자인 */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

    .hidden-modal { display: none !important; }
  </style>
</head>
<body class="text-slate-800">

  <div class="min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto space-y-6">
      
      <!-- 헤더 -->
      <header class="bg-blue-600 text-white p-6 rounded-2xl shadow-lg flex justify-between items-center gap-4 flex-wrap">
        <div class="flex items-center gap-4">
          <i class="fa-solid fa-graduation-cap text-4xl"></i>
          <div>
            <h1 class="text-xl sm:text-2xl font-bold flex items-center gap-2">
              2026학년도 고입 진학 관리
            </h1>
            <p class="text-blue-100 mt-1 flex items-center gap-1.5 text-sm sm:text-base">
              화명중학교 3학년 담임용 (개인 PC 전용)
            </p>
          </div>
        </div>
        
        <div class="flex items-center gap-3">
          <!-- 자동 저장 상태 표시 배지 -->
          <span class="flex items-center gap-1.5 text-sm font-medium px-3 py-1.5 rounded-full text-blue-800 bg-blue-100 border border-blue-200">
            <i class="fa-solid fa-cloud-arrow-down"></i> 브라우저 자동저장 켜짐
          </span>
        </div>
      </header>

      <!-- 안내 메시지 -->
      <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg shadow-sm flex items-start gap-3">
        <i class="fa-solid fa-circle-info text-blue-500 text-xl mt-0.5 shrink-0"></i>
        <div>
          <h3 class="text-blue-800 font-bold mb-1">현재 사용 중인 PC에 데이터가 자동 저장됩니다.</h3>
          <p class="text-blue-700 text-sm">새로고침을 하거나 브라우저를 다시 켜도 데이터가 유지됩니다. 단, 다른 컴퓨터나 스마트폰에서 접속하면 데이터가 보이지 않으니 현재 PC(교무실 자리 등)에서 전담하여 관리해 주세요.</p>
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- 좌측 패널 (전형일정 / 학군 정보) -->
        <div class="space-y-6">
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
            <h2 class="text-lg font-bold flex items-center gap-2 mb-4 text-slate-800">
              <i class="fa-regular fa-calendar text-blue-500 text-xl"></i> 주요 고입 전형 일정
            </h2>
            <div id="schedule-list" class="space-y-3"></div>
            <div class="mt-4 p-3 bg-orange-50 text-orange-800 rounded-lg text-xs flex gap-2 items-start">
              <i class="fa-solid fa-circle-exclamation mt-0.5 text-base"></i>
              <p>전기학교(과학고, 특성화고 등) 1개교 합격 시 후기학교 지원이 불가합니다. 이중지원에 유의해주세요.</p>
            </div>
          </div>

          <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
            <h2 class="text-lg font-bold flex items-center gap-2 mb-4 text-slate-800">
              <i class="fa-solid fa-location-dot text-emerald-500 text-xl"></i> 북부학군 평준화 일반고
            </h2>
            <p class="text-sm text-slate-600 mb-3">제2·4지망 대상 학교입니다.</p>
            <div id="school-list" class="flex flex-wrap gap-2"></div>
          </div>
        </div>

        <!-- 우측 패널 (학생 등록 / 목록) -->
        <div class="lg:col-span-2 space-y-6">
          
          <!-- 학생 등록 폼 -->
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-200">
            <h2 class="text-lg font-bold flex items-center gap-2 mb-4 text-slate-800">
              <i class="fa-solid fa-user-plus text-indigo-500 text-xl"></i> 진학 희망 추가
            </h2>
            <form id="add-student-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="flex gap-4">
                <div class="w-1/3">
                  <label class="block text-xs font-semibold text-slate-500 mb-1">번호</label>
                  <input type="number" id="form-num" required class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="예: 1">
                </div>
                <div class="w-2/3">
                  <label class="block text-xs font-semibold text-slate-500 mb-1">이름</label>
                  <input type="text" id="form-name" required class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="예: 홍길동">
                </div>
              </div>
              
              <div>
                <label class="block text-xs font-semibold text-slate-500 mb-1">지원 전형 유형</label>
                <select id="form-type" class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"></select>
              </div>

              <div class="md:col-span-2 flex gap-4 items-end">
                <div class="flex-1">
                  <label class="block text-xs font-semibold text-slate-500 mb-1">희망 고등학교명</label>
                  <input type="text" id="form-school" required class="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none" placeholder="학교명을 입력하세요 (예: 화명고)">
                </div>
                <button type="submit" class="px-6 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-lg transition-colors whitespace-nowrap shadow-sm">
                  명단에 추가
                </button>
              </div>
            </form>
          </div>

          <!-- 목록 테이블 -->
          <div class="bg-white p-0 rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-5 border-b border-slate-200 flex justify-between items-center bg-slate-50">
              <h2 class="text-lg font-bold flex items-center gap-2 text-slate-800">
                <i class="fa-solid fa-list-check text-green-500 text-xl"></i> 원서 접수 현황
              </h2>
              <div id="total-count" class="text-sm text-slate-500 font-medium">총 0명</div>
            </div>
            
            <div class="overflow-x-auto">
              <table class="w-full text-left border-collapse">
                <thead>
                  <tr class="bg-white border-b border-slate-200 text-sm text-slate-500">
                    <th class="p-4 font-semibold text-center w-16">번호</th>
                    <th class="p-4 font-semibold w-24">이름</th>
                    <th class="p-4 font-semibold">지원 학교 및 유형</th>
                    <th class="p-4 font-semibold text-center w-28">접수 상태</th>
                    <th class="p-4 font-semibold text-center w-16">관리</th>
                  </tr>
                </thead>
                <tbody id="student-list-body">
                  <!-- JS로 데이터 렌더링 됨 -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 삭제 확인 모달 -->
  <div id="delete-modal" class="hidden-modal fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl p-6 max-w-sm w-full shadow-xl">
      <h3 class="text-lg font-bold mb-2 text-slate-800">지원 정보 삭제</h3>
      <p class="text-slate-600 mb-6 text-sm">정말 이 지원 희망 정보를 삭제하시겠습니까?</p>
      <div class="flex justify-end gap-2">
        <button onclick="closeModal()" class="px-4 py-2 font-medium text-slate-600 hover:bg-slate-100 rounded-lg transition-colors">취소</button>
        <button onclick="confirmDelete()" class="px-4 py-2 font-medium bg-red-600 text-white hover:bg-red-700 rounded-lg transition-colors">삭제</button>
      </div>
    </div>
  </div>

  <!-- ==========================================
       자바스크립트 로직 (Vanilla JS - LocalStorage)
       ========================================== -->
  <script>
    // --- 상수 및 데이터 정의 ---
    const SCHEDULE_DATA = [
      { id: 'science', type: '과학고', dates: '2025. 8. 28.(목) ~ 9. 1.(월)' },
      { id: 'meister', type: '마이스터고/예체능/특별(항공·해군)', dates: '2025. 10. 20.(월) ~ 10. 23.(목)' },
      { id: 'special_special', type: '특성화고 특별전형', dates: '2025. 11. 24.(월) ~ 11. 25.(화)' },
      { id: 'special_general', type: '특성화고 일반/고등기술/학력인정', dates: '2025. 12. 1.(월) ~ 12. 2.(화)' },
      { id: 'general_principal', type: '학교장전형 일반고', dates: '2025. 12. 8.(월) ~ 12. 10.(수)' },
      { id: 'foreign_intl', type: '외고/국제고/자사고', dates: '2025. 12. 8.(월) ~ 12. 10.(수)' },
      { id: 'general_standard', type: '평준화적용 일반고', dates: '2025. 12. 8.(월) ~ 12. 10.(수)' }
    ];

    const BUKBU_SCHOOLS = [
      '구덕고', '금곡고', '낙동고', '만덕고', '부산강서고', '부산백양고', '사상고', 
      '화명고', '금명여고', '주례여고', '성도고', '경혜여고', '대덕여고'
    ];

    // --- 상태 변수 (LocalStorage 연동) ---
    // 로컬 스토리지에서 데이터를 불러옵니다. 없으면 빈 배열[]로 시작합니다.
    let students = JSON.parse(localStorage.getItem('hwamyeong_local_data')) || [];
    let deleteTarget = { studentId: null, appId: null };

    // --- 초기화 ---
    window.onload = () => {
      renderStaticData();
      renderStudents();
    };

    // 정적 데이터 UI 그리기 (일정표, 학군 목록, Select 태그)
    function renderStaticData() {
      // 1. 일정표 렌더링
      const scheduleContainer = document.getElementById('schedule-list');
      scheduleContainer.innerHTML = SCHEDULE_DATA.map(item => `
        <div class="p-3 bg-slate-50 rounded-lg text-sm border border-slate-100">
          <div class="font-semibold text-blue-700">${item.type}</div>
          <div class="text-slate-600 mt-1">${item.dates}</div>
        </div>
      `).join('');

      // 2. 북부 학군 렌더링
      const schoolContainer = document.getElementById('school-list');
      schoolContainer.innerHTML = BUKBU_SCHOOLS.map(school => `
        <span class="px-2.5 py-1 bg-emerald-50 text-emerald-700 rounded-full text-xs font-medium border border-emerald-200">${school}</span>
      `).join('');

      // 3. 셀렉트 박스 렌더링
      const selectBox = document.getElementById('form-type');
      selectBox.innerHTML = SCHEDULE_DATA.map(item => `<option value="${item.id}">${item.type}</option>`).join('');
    }

    // 데이터를 저장소에 영구 기록하고 화면 갱신
    function saveDataAndRender() {
      localStorage.setItem('hwamyeong_local_data', JSON.stringify(students));
      renderStudents();
    }

    // --- 이벤트 핸들러 ---
    
    // 학생 추가 (Form Submit)
    document.getElementById('add-student-form').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const num = document.getElementById('form-num').value.trim();
      const name = document.getElementById('form-name').value.trim();
      const type = document.getElementById('form-type').value;
      const school = document.getElementById('form-school').value.trim();

      const newApp = {
        id: Date.now().toString(),
        schoolType: type,
        schoolName: school,
        status: 'pending'
      };

      const existingIdx = students.findIndex(s => s.num === num);
      
      if (existingIdx > -1) {
        // 기존 학생 번호가 있으면 이름 업데이트 및 지원학교 추가(병합)
        students[existingIdx].name = name;
        students[existingIdx].applications.push(newApp);
      } else {
        // 새 학생 객체 생성
        students.push({
          id: 's' + Date.now().toString(),
          num: num,
          name: name,
          applications: [newApp]
        });
      }

      // 폼 비우기
      document.getElementById('form-num').value = '';
      document.getElementById('form-name').value = '';
      document.getElementById('form-school').value = '';
      
      saveDataAndRender();
    });

    // 접수 상태 변경
    function toggleStatus(studentId, appIdToToggle) {
      const studentIdx = students.findIndex(s => s.id === studentId);
      if (studentIdx === -1) return;
      
      const appIdx = students[studentIdx].applications.findIndex(a => a.id === appIdToToggle);
      if (appIdx === -1) return;

      const currentStatus = students[studentIdx].applications[appIdx].status;
      students[studentIdx].applications[appIdx].status = currentStatus === 'pending' ? 'completed' : 'pending';
      
      saveDataAndRender();
    }

    // 삭제 확인 모달 열기
    function requestDelete(studentId, appId) {
      deleteTarget = { studentId, appId };
      document.getElementById('delete-modal').classList.remove('hidden-modal');
    }

    // 모달 닫기
    function closeModal() {
      document.getElementById('delete-modal').classList.add('hidden-modal');
      deleteTarget = { studentId: null, appId: null };
    }

    // 삭제 확정
    function confirmDelete() {
      const { studentId, appId } = deleteTarget;
      const studentIdx = students.findIndex(s => s.id === studentId);
      if (studentIdx === -1) return;

      // 해당 지원 내역만 삭제
      students[studentIdx].applications = students[studentIdx].applications.filter(a => a.id !== appId);
      
      // 만약 지원 내역이 0개가 되면 학생 데이터 자체를 날림
      if (students[studentIdx].applications.length === 0) {
        students.splice(studentIdx, 1);
      }

      closeModal();
      saveDataAndRender();
    }

    // --- UI 렌더링 헬퍼 ---
    function renderStudents() {
      const tbody = document.getElementById('student-list-body');
      
      // 번호순 오름차순 정렬
      const sortedStudents = [...students].sort((a, b) => parseInt(a.num) - parseInt(b.num));
      
      document.getElementById('total-count').innerText = `총 ${sortedStudents.length}명`;

      if (sortedStudents.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" class="p-12 text-center text-slate-400">
          아직 등록된 학생이 없습니다. 위 폼에서 학생을 추가해주세요.
        </td></tr>`;
        return;
      }

      let html = '';
      sortedStudents.forEach(student => {
        student.applications.forEach((app, index) => {
          const typeInfo = SCHEDULE_DATA.find(t => t.id === app.schoolType);
          const isCompleted = app.status === 'completed';
          const isLast = index === student.applications.length - 1;
          
          html += `<tr class="hover:bg-slate-50 transition-colors ${isCompleted ? 'bg-slate-50/50' : ''} ${isLast ? 'border-b-2 border-slate-200' : 'border-b border-slate-100'}">`;
          
          // RowSpan 처리 (다중 지원 시 세로로 셀 병합)
          if (index === 0) {
            html += `<td rowspan="${student.applications.length}" class="p-4 text-center font-medium text-slate-700 bg-white border-r border-slate-100 align-middle">${student.num}</td>`;
            html += `<td rowspan="${student.applications.length}" class="p-4 font-semibold text-slate-800 bg-white border-r border-slate-100 align-middle">${student.name}</td>`;
          }

          html += `
            <td class="p-4">
              <div class="font-bold text-slate-800">${app.schoolName}</div>
              <div class="text-xs text-blue-600 mt-0.5">${typeInfo ? typeInfo.type : ''}</div>
            </td>
            <td class="p-4 text-center">
              <button onclick="toggleStatus('${student.id}', '${app.id}')" class="inline-flex items-center justify-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-bold transition-colors w-full ${isCompleted ? 'bg-green-100 text-green-700 hover:bg-green-200' : 'bg-slate-100 text-slate-500 hover:bg-slate-200'}">
                <i class="${isCompleted ? 'fa-solid fa-circle-check' : 'fa-regular fa-circle'}"></i>
                ${isCompleted ? '접수완료' : '접수전'}
              </button>
            </td>
            <td class="p-4 text-center">
              <button onclick="requestDelete('${student.id}', '${app.id}')" class="p-1.5 text-slate-400 hover:text-red-500 rounded transition-colors" title="삭제">
                <i class="fa-solid fa-trash-can"></i>
              </button>
            </td>
          </tr>`;
        });
      });
      tbody.innerHTML = html;
    }
  </script>
</body>
</html>
